<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
<html>
  <head>
    <title>
      cellHTS2 Experiment Report
    </title>
    <link rel="stylesheet" href="./cellHTS.css" type="text/css">
    <script type="text/javascript" src="./cellHTS.js"></script>
    <script src="./sorttable.js"></script>
   </head>
   <body onload="initialize();">
     <script type="text/javascript" src="./wz_tooltip.js"></script>
<p class="verbatim">
---<br>title:   Edu Screen - siDDR - cellHTS2 Data Analysis<br>author: "Robin Sebastian/Gianluca Pegoraro"<br>date: "Aug, 26 2021"<br>output: "html_document"<br>---<br><br>### README<br><br>This script is used to analyze siRNA screen data obtained with High-Content Image analysis. In particular, the siRNA library used is the ThermoFisher DDR siRNA Silencer Select. The library contains 3 oligo siRNA sequences per gene against 521 genes. The library was originally received dried in 384 well Labcyte PP plates at 0.25 nmole synthesis scale. concentration. It was resuspended in 50 ul ddH20 (5 uM final), frozen and then thawed to increase oligo siRNA solubility. For every mother plate, 3 384-LDV daughter plates (13 ul each) were generated at the same concentration. Columns 23 and 24 were originally left empty, and siRNA controls were added at a later stage. All these steps were performed using a PE Janus, which output all the liquid handling operations logs as text files.<br><br>Imaging assay-ready plates were generated by spotting 150 nl of siRNA oligo at the bottom of each plate using an Echo525. Imaging Assay plates were dried, frozen and then used in reverse transfection experiments. For reverese transfection, plates were thawed, spinned and 20 ul of Optimem + 0.05 ul/well of RNAiMax were added to the plates and incubated for 30'. Then 20 ul of cells were added on top of the siRNA/RNAiMax mix and incubated for 72 hrs.<br><br>Fixed and stained plates were imaged on an CV7000S microscope using a 60X water objective. Images were analyzed Columbus 2.9.1, and image analysis results were exported as txt.files.<br><br>The script reads data generated by the `HTS2_Dataprep.rmd` script, runs the `cellHTS2` analysis and outputs html reports, .txt results tables, and some custom plots of the z-score distributions.<br><br>### Setup<br><br>Load packages.<br><br>```{r}<br>library(tidyverse)<br>library(cellHTS2)<br>```<br><br>### User variables input and settings specification<br><br>Choose a Columbus image analysis result variable that needs to be analized in `cellHTS2`. This might change from analysis to analysis. The chunk below assigns the Columbus variable chosen for analysis and sets the `cellHTS2` input and output directories names accordingly .<br><br>```{r}<br>well_tbl <- read_csv(file.path("knitr_output", "edu_ddr_well_results.csv"))<br>annotation_tbl <- read_tsv(file.path("HTS2_Metadata", "Annotation.txt"))<br><br>var_names <- well_tbl %>% select(nuclei_n:spots_edu_pos_median_ratio) %>% names()<br>```<br><br>## `cellHTS2` data analysis<br><br>```{r importPlateList}<br>##`cellHTS2` data analysis function<br><br>calculate_HTS2 <- function(meas_select, in_dir = NULL, metadata_dir = NULL, out_dir = NULL){<br>  <br>  #Read the measurement files in the in_dir directory. <br>  obj <- readPlateList(filename = "Platelist.txt",<br>                             name = meas_select,<br>                             path = file.path(in_dir, meas_select))<br>  <br>  #Configure the cellHTS2 object<br>  obj <- configure(obj,<br>                   descripFile = "Description.txt",<br>                   confFile = "Plateconf.txt",<br>                   path = metadata_dir)<br>  <br>  #Normalize the measurements on a per plate-basis.<br>  obj_n <- normalizePlates(obj,<br>                          scale = "additive",<br>                          log = FALSE,<br>                          method = "Bscore", #Spatial normalization<br>                          varianceAdjust = "byPlate")<br><br>  #Score the replicates by taking the Z-score of the B-score distribution <br>  # calculated in the previous chunk.<br>  obj_sc <- scoreReplicates(obj_n, <br>                            sign = "+", <br>                            method = "zscore")<br>  <br>  #Summarize the replicates. In this particular case the final Z-score is going <br>  # to be the mean of the two replicates Z-scores. <br>  obj_sc <-summarizeReplicates(obj_sc, <br>                               summary = "mean")<br>  <br>  # Annotate the cellHTS2 object with gene names and siRNA id's. <br>  obj_sc <- cellHTS2::annotate(obj_sc,<br>                               geneIDFile = "Annotation.txt",<br>                               path = metadata_dir)<br><br>  #Save the cellHTS2 object as an `.rda` file in the appropriate results <br>  #subfolder in case someone wants to inspect it and/or further process it.<br>  save(obj_sc, file = file.path(out_dir, <br>                                meas_select, <br>                                "obj_sc.rda"))<br>  <br>    <br>  setSettings(list(plateList = list(reproducibility = list(include = TRUE, <br>                                                           map = TRUE),<br>                                    intensities = list(include = TRUE, map = TRUE)),<br>                   screenSummary = list(scores = list(range = c(-8, 8), map = TRUE))))<br>  <br>  # Write the report in the appropriate output directory<br>  cellHTS2_report <- writeReport(raw = obj,<br>                                normalized = obj_n,<br>                                scored = obj_sc,<br>                                outdir = file.path(out_dir, <br>                                                   meas_select),<br>                                force = TRUE,<br>                                mainScriptFile = "HTS2_Analysis.Rmd")<br>  <br>  #Write the results table in the appropriate output directory                             <br>  results_tbl <- getTopTable(cellHTSlist = list("raw" = obj,<br>                                                "normalized" = obj_n,<br>                                                "scored" = obj_sc),<br>                            file = file.path(out_dir, <br>                                             meas_select, <br>                                             "Results_table.txt"))<br>  <br>  #Calculate and write the median strongest siRNA per gene (Based on Z-scores)<br>  results_median_tbl <- results_tbl %>% <br>                        filter(!(is.na(GeneSymbol))) %>%<br>                        group_by(GeneID, GeneSymbol) %>%<br>                        summarise(median_z_score = median(score)) %>%<br>                        arrange(desc(median_z_score)) %>%<br>                        write_tsv(file.path(out_dir, <br>                                            meas_select, <br>                                            "Results_median_table.txt"))<br>  #Calculate and write the RSA scores<br>  rsa_tbl <- rsa(obj_sc, reverse = T) %>%<br>             filter(!(is.na(GeneID))) %>%<br>             mutate(Plate = as.integer(Plate)) %>%<br>             left_join(annotation_tbl,<br>                       by = c("Plate", "Well")) %>%<br>             arrange(RSARank) %>%<br>             write_tsv(file.path(out_dir,<br>                                meas_select,<br>                                "Results_RSA_table.txt"))<br>  rsa_tbl_filter <- rsa_tbl %>%<br>                    mutate(Flag = Score > 1.5) %>%<br>                    group_by(GeneID.x) %>%<br>                    summarise(Flag = sum(Flag) >= 2)<br><br>  rsa_filtered_tbl <- rsa_tbl %>%<br>                      left_join(rsa_tbl_filter, by = "GeneID.x") %>%<br>                      filter(Flag)<br><br>  write_tsv(rsa_filtered_tbl,<br>            file.path(out_dir,<br>                      meas_select,<br>                      "Results_Filtered_RSA_table.txt"))<br>}<br>```<br><br>```{r}<br>var_names %>% walk(calculate_HTS2, in_dir = "HTS2_Input/", metadata_dir = "HTS2_Metadata/", out_dir = "HTS2_Output/")<br>```<br><br>Document the information about the analysis session<br><br>```{r sessionInfo, results='markup'}<br>sessionInfo()<br>```
</p>
  </body>
</html>
